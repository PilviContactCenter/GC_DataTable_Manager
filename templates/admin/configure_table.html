{% extends "base.html" %}

{% block title %}Configure Table - {{ table_id }}{% endblock %}

{% block header %}
<div class="flex items-center justify-between">
    <span>Configure Table Permissions</span>
    <a href="{{ url_for('admin_user_tables', user_id=user.id) }}" class="text-sm font-medium text-indigo-600 hover:text-indigo-500">
        &larr; Back to Tables
    </a>
</div>
{% endblock %}

{% block content %}
<form method="POST">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
    <div class="space-y-12">
        <div class="border-b border-gray-900/10 pb-12">
            <h2 class="text-base font-semibold leading-7 text-gray-900">Table: {{ table_id }}</h2>
            <p class="mt-1 text-sm leading-6 text-gray-600">User: {{ user.email }}</p>

            <!-- Global permissions checkboxes removed as per request -->
            <!--
            <div class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6">
                <div class="sm:col-span-4 space-y-4">
                    <div class="relative flex gap-x-3">
                        <div class="flex h-6 items-center">
                            <input id="can_update" name="can_update" type="checkbox" {% if table_perms.get('can_update_rows') %}checked{% endif %} class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600">
                        </div>
                        <div class="text-sm leading-6">
                            <label for="can_update" class="font-medium text-gray-900">Allow Update Rows</label>
                            <p class="text-gray-500">If checked, sets all columns to "Read & Write".</p>
                        </div>
                    </div>
                    
                    <div class="relative flex gap-x-3">
                        <div class="flex h-6 items-center">
                            <input id="can_read" name="can_read" type="checkbox" {% if table_perms.get('can_read_rows') %}checked{% endif %} onchange="toggleAllColumns('read')" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600">
                        </div>
                        <div class="text-sm leading-6">
                            <label for="can_read" class="font-medium text-gray-900">Allow Read Rows</label>
                            <p class="text-gray-500">If checked, sets all columns to "Read Only".</p>
                        </div>
                    </div>
                </div>
            </div>
            -->
        </div>

        <div class="border-b border-gray-900/10 pb-12">
            <h2 class="text-base font-semibold leading-7 text-gray-900">Column Permissions</h2>
            <p class="mt-1 text-sm leading-6 text-gray-600">Configure access level for each column.</p>

            <div class="mt-10 space-y-6">
                {% if schema %}
                    {% for col_name, col_props in schema.items() %}
                    {% set current_perm = table_perms.get('columns', {}).get(col_name, 'none') %}
                    <div class="grid grid-cols-1 gap-x-6 gap-y-4 sm:grid-cols-6 items-center">
                        <div class="sm:col-span-2">
                            <label class="block text-sm font-medium leading-6 text-gray-900">{{ col_name }}</label>
                            <p class="text-xs text-gray-500">{{ col_props.get('title', col_name) }}</p>
                        </div>
                        <div class="sm:col-span-4">
                            <select name="col_{{ col_name }}" class="column-select block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:max-w-xs sm:text-sm sm:leading-6">
                                <option value="none" {% if current_perm == 'none' %}selected{% endif %}>None (Hidden)</option>
                                <option value="read" {% if current_perm == 'read' %}selected{% endif %}>Read Only</option>
                                <option value="write" {% if current_perm == 'write' %}selected{% endif %}>Read & Write</option>
                            </select>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="text-sm text-yellow-600">Schema not available. Cannot configure columns.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="mt-6 flex items-center justify-end gap-x-6">
        <a href="{{ url_for('admin_user_tables', user_id=user.id) }}" class="text-sm font-semibold leading-6 text-gray-900">Cancel</a>
        <button type="submit" class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Save</button>
    </div>
</form>

<!--
<script>
    function toggleAllColumns(mode) {
        const selects = document.querySelectorAll('.column-select');
        const updateCheckbox = document.getElementById('can_update');
        const readCheckbox = document.getElementById('can_read');
        
        if (mode === 'update' && updateCheckbox.checked) {
            // If update is checked, uncheck read and set all to write
            readCheckbox.checked = false;
            selects.forEach(select => select.value = 'write');
        } else if (mode === 'read' && readCheckbox.checked) {
            // If read is checked, uncheck update and set all to read
            updateCheckbox.checked = false;
            selects.forEach(select => select.value = 'read');
        }
    }
    
    // Attach event listener to update checkbox separately to pass argument
    document.getElementById('can_update').addEventListener('change', function() {
        toggleAllColumns('update');
    });
</script>
-->
{% endblock %}