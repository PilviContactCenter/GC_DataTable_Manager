{% extends "base.html" %}

{% block title %}Dashboard - Genesys Cloud Data Tables{% endblock %}

{% block header %}Available Data Tables{% endblock %}

{% block content %}
<div class="overflow-hidden bg-white shadow sm:rounded-md p-4">
    {% if tables %}
    <table id="tablesList" class="min-w-full divide-y divide-gray-300">
        <thead>
            <tr>
                <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-0">Name</th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Description</th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">ID</th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Status</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
            {% for table in tables %}
            <tr class="hover:bg-gray-50 cursor-pointer" onclick="window.location.href='{{ url_for('view_table', table_id=table.Id) }}'">
                <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-indigo-600 sm:pl-0">{{ table.Name }}</td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">{{ table.Description }}</td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500"><code class="text-xs bg-gray-100 p-1 rounded">{{ table.Id }}</code></td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                    <span class="inline-flex rounded-full bg-green-100 px-2 text-xs font-semibold leading-5 text-green-800">Active</span>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="text-center py-5">
        <h4 class="text-gray-500">No Data Tables Found</h4>
        {% if user_role == 'admin' %}
            <p class="text-gray-400">It seems there are no Data Tables in your Genesys Cloud organization, or the API credentials might be incorrect.</p>
            <p class="text-gray-400">Check your <a href="{{ url_for('admin_config') }}" class="text-indigo-600">Configuration</a>.</p>
        {% else %}
            <p class="text-gray-400">You do not have permission to view any tables. Please contact your administrator.</p>
        {% endif %}
    </div>
    {% endif %}
</div>

<script>
    $(document).ready(function() {
        {% if tables %}
        $('#tablesList').DataTable({
            "pageLength": 10,
            "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]
        });
        {% endif %}
    });

    // Auto-refresh every 60 seconds to check for new tables
    setTimeout(function() {
        window.location.reload();
    }, 60000);
</script>
{% endblock %}